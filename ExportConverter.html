<!DOCTYPE html>
<html>
<head>
  <title>JSON Upload and Image Generator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/4.5.1/fabric.min.js"></script>
</head>
<body>
  <input type="file" id="jsonFile" name="jsonFile" accept=".json">
  <button id="downloadBtn" disabled>Download Images</button>
  <div id="canvasContainer"></div>

  <script>
  var data;
  $(document).ready(function() {
    $("#jsonFile").change(function(e) {
      let file = e.target.files[0];
      if (file) {
        let reader = new FileReader();
        reader.onload = function(event) {
          data = JSON.parse(event.target.result);
          $("#downloadBtn").prop('disabled', false);
        };
        reader.readAsText(file);
      }
    });

    $("#downloadBtn").click(function() {
      if (data) {
        generateImages(data);
      }
    });
  });

  function generateImages(data) {
    $("#canvasContainer").empty(); // Clear the container before adding new canvases
    data.forEach((item, index) => {
      let canvasEl = document.createElement('canvas');
      canvasEl.id = `canvas${index}`;
      $("#canvasContainer").append(canvasEl);

      let canvas = new fabric.Canvas(`canvas${index}`, { width: 500, height: 200 });
      let text = new fabric.Textbox(`Prompt: ${item.prompt}\nResponse: ${item.response}`, {
        left: 10,
        top: 10,
        fontFamily: 'Arial',
        fill: '#000',
        fontSize: 14
      });
      canvas.add(text);
      canvas.renderAll();

      let image = canvas.toDataURL("image/png").replace("image/png", "image/octet-stream");

      let link = document.createElement('a');
      link.download = `${item.prompt}_${index}.png`;
      link.href = image;
      link.click();
    });
  }
  </script>
</body>
</html>

